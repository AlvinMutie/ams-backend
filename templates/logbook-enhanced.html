<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Enhanced Logbook - Student</title>
  <link rel="stylesheet" href="../dashboard-styles.css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <!-- Rich Text Editor CSS -->
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
</head>
<body>
  <!-- Top Bar -->
  <div class="top-bar">
    <div class="top-bar-left">
      <img src="https://www.jkuat.ac.ke/wp-content/uploads/2020/01/jkuat-logo.png" alt="JKUAT" height="40">
    </div>
    <div class="top-bar-center">
      Jomo Kenyatta University of Agriculture and Technology
    </div>
    <div class="top-bar-right">
      <div class="notification-bell">
        <i class="fas fa-bell"></i>
        <span class="notification-badge">3</span>
      </div>
      <div class="user-menu">
        <span>Hi, Kyalo Mwangi</span>
        <i class="fas fa-chevron-down"></i>
      </div>
    </div>
  </div>

  <!-- Left Sidebar -->
  <div class="sidebar">
    <div class="sidebar-logo">
      <img src="https://www.jkuat.ac.ke/wp-content/uploads/2020/01/jkuat-logo.png" alt="JKUAT Logo">
    </div>
    
    <div class="sidebar-menu">
      <a href="dashboard-enhanced.html" class="menu-item">
        <i class="fas fa-tachometer-alt"></i>
        <span>Dashboard</span>
      </a>
      <a href="logbook-enhanced.html" class="menu-item active">
        <i class="fas fa-book"></i>
        <span>Logbook</span>
      </a>
      <a href="return_form.html" class="menu-item">
        <i class="fas fa-file-alt"></i>
        <span>Return Form</span>
      </a>
      <a href="final_report.html" class="menu-item">
        <i class="fas fa-chart-line"></i>
        <span>Final Report</span>
      </a>
      <a href="deferral_request.html" class="menu-item">
        <i class="fas fa-calendar-times"></i>
        <span>Deferral Request</span>
      </a>
      <a href="download_logbook.html" class="menu-item">
        <i class="fas fa-download"></i>
        <span>Download Logbook</span>
      </a>
      <a href="../login.html" class="menu-item">
        <i class="fas fa-sign-out-alt"></i>
        <span>Logout</span>
      </a>
    </div>
    
    <div class="sidebar-footer">
      Â©2025 - Alvin and Dominic
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <h1 class="page-title">Enhanced Logbook</h1>
    
    <!-- Welcome Section -->
    <div class="welcome-section">
      <div class="welcome-text">
        <h2>Logbook Management</h2>
        <p>Create detailed logbook entries with rich text formatting, images, and code snippets. Track your daily activities and learning progress.</p>
      </div>
      <div class="welcome-illustration">
        <i class="fas fa-book-open"></i>
      </div>
    </div>

    <!-- Logbook Stats -->
    <div class="stats-overview">
      <div class="stat-item">
        <div class="stat-number">7</div>
        <div class="stat-label">Total Entries</div>
      </div>
      <div class="stat-item">
        <div class="stat-number">5</div>
        <div class="stat-label">Approved</div>
      </div>
      <div class="stat-item">
        <div class="stat-number">2</div>
        <div class="stat-label">Pending</div>
      </div>
      <div class="stat-item">
        <div class="stat-number">320</div>
        <div class="stat-label">Total Hours</div>
      </div>
    </div>

    <!-- Main Content Grid -->
    <div class="dashboard-grid">
      <!-- Left Column - New Entry Form -->
      <div class="dashboard-left">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Create New Logbook Entry</h3>
            <div class="card-actions">
              <button class="btn-secondary" onclick="saveDraft()">
                <i class="fas fa-save"></i>
                Save Draft
              </button>
              <button class="btn-primary" onclick="submitEntry()">
                <i class="fas fa-paper-plane"></i>
                Submit Entry
              </button>
            </div>
          </div>
          
          <form id="logbookForm" class="logbook-form">
            <!-- Basic Information -->
            <div class="form-section">
              <h4>Entry Information</h4>
              <div class="form-row">
                <div class="form-group">
                  <label for="entry_date">Date *</label>
                  <input type="date" id="entry_date" name="entry_date" required>
                </div>
                <div class="form-group">
                  <label for="week_number">Week Number *</label>
                  <select id="week_number" name="week_number" required>
                    <option value="">Select Week</option>
                    <option value="1">Week 1</option>
                    <option value="2">Week 2</option>
                    <option value="3">Week 3</option>
                    <option value="4">Week 4</option>
                    <option value="5">Week 5</option>
                    <option value="6">Week 6</option>
                    <option value="7">Week 7</option>
                    <option value="8">Week 8</option>
                    <option value="9">Week 9</option>
                    <option value="10">Week 10</option>
                    <option value="11">Week 11</option>
                    <option value="12">Week 12</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="hours_worked">Hours Worked *</label>
                  <input type="number" id="hours_worked" name="hours_worked" min="1" max="24" required>
                </div>
              </div>
            </div>

            <!-- Activities Performed -->
            <div class="form-section">
              <h4>Activities Performed *</h4>
              <div class="rich-editor-container">
                <div id="activitiesEditor" class="rich-editor"></div>
                <input type="hidden" name="activities_content" id="activitiesContent">
              </div>
              <div class="editor-toolbar">
                <button type="button" class="toolbar-btn" onclick="insertTemplate('activities')">
                  <i class="fas fa-file-alt"></i>
                  Insert Template
                </button>
                <button type="button" class="toolbar-btn" onclick="addCodeBlock()">
                  <i class="fas fa-code"></i>
                  Add Code
                </button>
                <button type="button" class="toolbar-btn" onclick="addImage()">
                  <i class="fas fa-image"></i>
                  Add Image
                </button>
              </div>
            </div>

            <!-- Learning Outcomes -->
            <div class="form-section">
              <h4>Learning Outcomes *</h4>
              <div class="rich-editor-container">
                <div id="learningEditor" class="rich-editor"></div>
                <input type="hidden" name="learning_content" id="learningContent">
              </div>
              <div class="editor-toolbar">
                <button type="button" class="toolbar-btn" onclick="insertTemplate('learning')">
                  <i class="fas fa-file-alt"></i>
                  Insert Template
                </button>
                <button type="button" class="toolbar-btn" onclick="addBulletPoints()">
                  <i class="fas fa-list"></i>
                  Add Bullet Points
                </button>
              </div>
            </div>

            <!-- Challenges Faced -->
            <div class="form-section">
              <h4>Challenges Faced</h4>
              <div class="rich-editor-container">
                <div id="challengesEditor" class="rich-editor"></div>
                <input type="hidden" name="challenges_content" id="challengesContent">
              </div>
              <div class="editor-toolbar">
                <button type="button" class="toolbar-btn" onclick="insertTemplate('challenges')">
                  <i class="fas fa-file-alt"></i>
                  Insert Template
                </button>
                <button type="button" class="toolbar-btn" onclick="addSolution()">
                  <i class="fas fa-lightbulb"></i>
                  Add Solution
                </button>
              </div>
            </div>

            <!-- Next Day's Plan -->
            <div class="form-section">
              <h4>Next Day's Plan</h4>
              <div class="rich-editor-container">
                <div id="planEditor" class="rich-editor"></div>
                <input type="hidden" name="plan_content" id="planContent">
              </div>
              <div class="editor-toolbar">
                <button type="button" class="toolbar-btn" onclick="insertTemplate('plan')">
                  <i class="fas fa-file-alt"></i>
                  Insert Template
                </button>
                <button type="button" class="toolbar-btn" onclick="addChecklist()">
                  <i class="fas fa-tasks"></i>
                  Add Checklist
                </button>
              </div>
            </div>

            <!-- Additional Notes -->
            <div class="form-section">
              <h4>Additional Notes</h4>
              <div class="rich-editor-container">
                <div id="notesEditor" class="rich-editor"></div>
                <input type="hidden" name="notes_content" id="notesContent">
              </div>
            </div>

            <!-- File Attachments -->
            <div class="form-section">
              <h4>File Attachments</h4>
              <div class="file-upload-area">
                <div class="upload-zone" id="uploadZone">
                  <i class="fas fa-cloud-upload-alt"></i>
                  <p>Drag and drop files here or click to browse</p>
                  <input type="file" id="fileInput" multiple accept=".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif,.txt,.zip,.rar" style="display: none;">
                </div>
                <div class="uploaded-files" id="uploadedFiles"></div>
              </div>
              <div class="upload-info">
                <small>Supported formats: PDF, DOC, DOCX, JPG, PNG, GIF, TXT, ZIP, RAR (Max 10MB per file)</small>
              </div>
            </div>
          </form>
        </div>
      </div>

      <!-- Right Column -->
      <div class="dashboard-right">
        <!-- Recent Entries -->
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Recent Entries</h3>
            <div class="card-actions">
              <a href="#" class="btn-secondary" onclick="viewAllEntries()">
                <i class="fas fa-eye"></i>
                View All
              </a>
            </div>
          </div>
          
          <div class="entries-list">
            <div class="entry-item approved">
              <div class="entry-header">
                <div class="entry-week">Week 6</div>
                <div class="entry-date">Aug 12, 2024</div>
                <div class="entry-status approved">â Approved</div>
              </div>
              <div class="entry-preview">
                <strong>Activities:</strong> Database optimization, API testing, and documentation updates...
              </div>
              <div class="entry-actions">
                <button class="btn-view" onclick="viewEntry(6)">
                  <i class="fas fa-eye"></i>
                  View
                </button>
                <button class="btn-edit" onclick="editEntry(6)">
                  <i class="fas fa-edit"></i>
                  Edit
                </button>
              </div>
            </div>
            
            <div class="entry-item pending">
              <div class="entry-header">
                <div class="entry-week">Week 5</div>
                <div class="entry-date">Aug 5, 2024</div>
                <div class="entry-status pending">â³ Pending</div>
              </div>
              <div class="entry-preview">
                <strong>Activities:</strong> Frontend development with React, UI improvements...
              </div>
              <div class="entry-actions">
                <button class="btn-view" onclick="viewEntry(5)">
                  <i class="fas fa-eye"></i>
                  View
                </button>
                <button class="btn-edit" onclick="editEntry(5)">
                  <i class="fas fa-edit"></i>
                  Edit
                </button>
              </div>
            </div>
            
            <div class="entry-item approved">
              <div class="entry-header">
                <div class="entry-week">Week 4</div>
                <div class="entry-date">Jul 29, 2024</div>
                <div class="entry-status approved">â Approved</div>
              </div>
              <div class="entry-preview">
                <strong>Activities:</strong> Backend API development, database design...
              </div>
              <div class="entry-actions">
                <button class="btn-view" onclick="viewEntry(4)">
                  <i class="fas fa-eye"></i>
                  View
                </button>
                <button class="btn-edit" onclick="editEntry(4)">
                  <i class="fas fa-edit"></i>
                  Edit
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Writing Tips -->
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Writing Tips</h3>
          </div>
          <div class="tips-list">
            <div class="tip-item">
              <div class="tip-icon">
                <i class="fas fa-lightbulb"></i>
              </div>
              <div class="tip-content">
                <h4>Be Specific</h4>
                <p>Include specific details about technologies used, tools, and methodologies</p>
              </div>
            </div>
            
            <div class="tip-item">
              <div class="tip-icon">
                <i class="fas fa-chart-line"></i>
              </div>
              <div class="tip-content">
                <h4>Show Progress</h4>
                <p>Highlight how your skills have improved and what you've learned</p>
              </div>
            </div>
            
            <div class="tip-item">
              <div class="tip-icon">
                <i class="fas fa-code"></i>
              </div>
              <div class="tip-content">
                <h4>Include Code</h4>
                <p>Add relevant code snippets to demonstrate your technical work</p>
              </div>
            </div>
            
            <div class="tip-item">
              <div class="tip-icon">
                <i class="fas fa-image"></i>
              </div>
              <div class="tip-content">
                <h4>Use Images</h4>
                <p>Include screenshots, diagrams, or photos to illustrate your work</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Quick Actions -->
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Quick Actions</h3>
          </div>
          <div class="quick-actions">
            <button class="quick-action-btn" onclick="exportEntry()">
              <i class="fas fa-download"></i>
              Export Entry
            </button>
            <button class="quick-action-btn" onclick="printEntry()">
              <i class="fas fa-print"></i>
              Print Entry
            </button>
            <button class="quick-action-btn" onclick="shareEntry()">
              <i class="fas fa-share"></i>
              Share Entry
            </button>
            <button class="quick-action-btn" onclick="duplicateEntry()">
              <i class="fas fa-copy"></i>
              Duplicate Entry
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Rich Text Editor JavaScript -->
  <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>

  <style>
    .stats-overview {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .stat-item {
      background: white;
      border: 1px solid #e9ecef;
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .stat-number {
      font-size: 2rem;
      font-weight: 700;
      color: #1e4d2b;
      margin-bottom: 5px;
    }
    
    .stat-label {
      color: #6c757d;
      font-size: 0.9rem;
      font-weight: 500;
    }
    
    .form-section {
      margin-bottom: 30px;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 8px;
      border: 1px solid #e9ecef;
    }
    
    .form-section h4 {
      color: #1e4d2b;
      margin-bottom: 15px;
      font-size: 1.1rem;
      border-bottom: 2px solid #e9ecef;
      padding-bottom: 10px;
    }
    
    .form-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
    }
    
    .form-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .form-group label {
      font-weight: 600;
      color: #495057;
      font-size: 0.9rem;
    }
    
    .form-group input,
    .form-group select {
      padding: 12px;
      border: 2px solid #e9ecef;
      border-radius: 6px;
      font-size: 0.9rem;
      transition: all 0.3s ease;
    }
    
    .form-group input:focus,
    .form-group select:focus {
      outline: none;
      border-color: #1e4d2b;
      box-shadow: 0 0 0 3px rgba(30, 77, 43, 0.1);
    }
    
    .rich-editor-container {
      margin-bottom: 15px;
    }
    
    .rich-editor {
      height: 200px;
      border: 2px solid #e9ecef;
      border-radius: 6px;
      background: white;
    }
    
    .rich-editor .ql-editor {
      min-height: 150px;
      font-size: 0.9rem;
      line-height: 1.6;
    }
    
    .editor-toolbar {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    
    .toolbar-btn {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 8px 12px;
      background: #f8f9fa;
      border: 1px solid #e9ecef;
      border-radius: 6px;
      color: #495057;
      font-size: 0.8rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .toolbar-btn:hover {
      background: #1e4d2b;
      color: white;
      border-color: #1e4d2b;
    }
    
    .file-upload-area {
      border: 2px dashed #e9ecef;
      border-radius: 8px;
      padding: 30px;
      text-align: center;
      background: #f8f9fa;
      transition: all 0.3s ease;
    }
    
    .file-upload-area:hover {
      border-color: #1e4d2b;
      background: #f0f8f0;
    }
    
    .upload-zone {
      cursor: pointer;
    }
    
    .upload-zone i {
      font-size: 3rem;
      color: #6c757d;
      margin-bottom: 15px;
    }
    
    .upload-zone p {
      color: #6c757d;
      margin: 0;
      font-size: 1rem;
    }
    
    .uploaded-files {
      margin-top: 20px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    
    .file-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px;
      background: white;
      border: 1px solid #e9ecef;
      border-radius: 6px;
    }
    
    .file-icon {
      width: 32px;
      height: 32px;
      background: #f8f9fa;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #6c757d;
    }
    
    .file-info {
      flex: 1;
    }
    
    .file-name {
      font-weight: 500;
      color: #495057;
      margin-bottom: 2px;
    }
    
    .file-size {
      font-size: 0.8rem;
      color: #6c757d;
    }
    
    .file-remove {
      background: none;
      border: none;
      color: #dc3545;
      cursor: pointer;
      padding: 5px;
    }
    
    .upload-info {
      margin-top: 10px;
      text-align: center;
    }
    
    .upload-info small {
      color: #6c757d;
    }
    
    .tips-list {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    
    .tip-item {
      display: flex;
      align-items: flex-start;
      gap: 15px;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 8px;
      border-left: 4px solid #1e4d2b;
    }
    
    .tip-icon {
      width: 40px;
      height: 40px;
      background: #1e4d2b;
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }
    
    .tip-content h4 {
      margin: 0 0 5px 0;
      color: #1e4d2b;
      font-size: 1rem;
    }
    
    .tip-content p {
      margin: 0;
      color: #6c757d;
      font-size: 0.9rem;
      line-height: 1.4;
    }
    
    .quick-actions {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    
    .quick-action-btn {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px 16px;
      background: #f8f9fa;
      border: 1px solid #e9ecef;
      border-radius: 8px;
      color: #1e4d2b;
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .quick-action-btn:hover {
      background: #1e4d2b;
      color: white;
      transform: translateY(-1px);
    }
    
    @media (max-width: 768px) {
      .form-row {
        grid-template-columns: 1fr;
      }
      
      .stats-overview {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .editor-toolbar {
        justify-content: center;
      }
    }
  </style>

  <script>
    // Initialize Rich Text Editors
    let activitiesEditor, learningEditor, challengesEditor, planEditor, notesEditor;
    
    // Quill configuration
    const quillConfig = {
      theme: 'snow',
      modules: {
        toolbar: [
          ['bold', 'italic', 'underline', 'strike'],
          ['blockquote', 'code-block'],
          [{ 'header': 1 }, { 'header': 2 }],
          [{ 'list': 'ordered'}, { 'list': 'bullet' }],
          [{ 'script': 'sub'}, { 'script': 'super' }],
          [{ 'indent': '-1'}, { 'indent': '+1' }],
          [{ 'direction': 'rtl' }],
          [{ 'size': ['small', false, 'large', 'huge'] }],
          [{ 'header': [1, 2, 3, 4, 5, 6, false] }],
          [{ 'color': [] }, { 'background': [] }],
          [{ 'font': [] }],
          [{ 'align': [] }],
          ['clean'],
          ['link', 'image', 'video']
        ]
      },
      placeholder: 'Start writing your entry...'
    };
    
    // Initialize editors when page loads
    document.addEventListener('DOMContentLoaded', function() {
      activitiesEditor = new Quill('#activitiesEditor', quillConfig);
      learningEditor = new Quill('#learningEditor', quillConfig);
      challengesEditor = new Quill('#challengesEditor', quillConfig);
      planEditor = new Quill('#planEditor', quillConfig);
      notesEditor = new Quill('#notesEditor', quillConfig);
      
      // Set default date to today
      document.getElementById('entry_date').valueAsDate = new Date();
      
      // Set default week number based on current date
      const currentDate = new Date();
      const startDate = new Date('2024-05-15'); // Attachment start date
      const weeksDiff = Math.ceil((currentDate - startDate) / (7 * 24 * 60 * 60 * 1000));
      if (weeksDiff > 0 && weeksDiff <= 12) {
        document.getElementById('week_number').value = weeksDiff;
      }
    });
    
    // File upload functionality
    const uploadZone = document.getElementById('uploadZone');
    const fileInput = document.getElementById('fileInput');
    const uploadedFiles = document.getElementById('uploadedFiles');
    
    uploadZone.addEventListener('click', () => fileInput.click());
    
    uploadZone.addEventListener('dragover', (e) => {
      e.preventDefault();
      uploadZone.style.borderColor = '#1e4d2b';
      uploadZone.style.background = '#f0f8f0';
    });
    
    uploadZone.addEventListener('dragleave', (e) => {
      e.preventDefault();
      uploadZone.style.borderColor = '#e9ecef';
      uploadZone.style.background = '#f8f9fa';
    });
    
    uploadZone.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadZone.style.borderColor = '#e9ecef';
      uploadZone.style.background = '#f8f9fa';
      
      const files = e.dataTransfer.files;
      handleFiles(files);
    });
    
    fileInput.addEventListener('change', (e) => {
      handleFiles(e.target.files);
    });
    
    function handleFiles(files) {
      Array.from(files).forEach(file => {
        if (file.size > 10 * 1024 * 1024) { // 10MB limit
          alert(`File ${file.name} is too large. Maximum size is 10MB.`);
          return;
        }
        
        addFileToList(file);
      });
    }
    
    function addFileToList(file) {
      const fileItem = document.createElement('div');
      fileItem.className = 'file-item';
      
      const fileIcon = document.createElement('div');
      fileIcon.className = 'file-icon';
      fileIcon.innerHTML = getFileIcon(file.type);
      
      const fileInfo = document.createElement('div');
      fileInfo.className = 'file-info';
      
      const fileName = document.createElement('div');
      fileName.className = 'file-name';
      fileName.textContent = file.name;
      
      const fileSize = document.createElement('div');
      fileSize.className = 'file-size';
      fileSize.textContent = formatFileSize(file.size);
      
      fileInfo.appendChild(fileName);
      fileInfo.appendChild(fileSize);
      
      const fileRemove = document.createElement('button');
      fileRemove.className = 'file-remove';
      fileRemove.innerHTML = '<i class="fas fa-times"></i>';
      fileRemove.onclick = () => fileItem.remove();
      
      fileItem.appendChild(fileIcon);
      fileItem.appendChild(fileInfo);
      fileItem.appendChild(fileRemove);
      
      uploadedFiles.appendChild(fileItem);
    }
    
    function getFileIcon(type) {
      if (type.includes('image')) return '<i class="fas fa-image"></i>';
      if (type.includes('pdf')) return '<i class="fas fa-file-pdf"></i>';
      if (type.includes('word')) return '<i class="fas fa-file-word"></i>';
      if (type.includes('text')) return '<i class="fas fa-file-alt"></i>';
      if (type.includes('zip') || type.includes('rar')) return '<i class="fas fa-file-archive"></i>';
      return '<i class="fas fa-file"></i>';
    }
    
    function formatFileSize(bytes) {
      if (bytes === 0) return '0 Bytes';
      const k = 1024;
      const sizes = ['Bytes', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }
    
    // Template insertion functions
    function insertTemplate(type) {
      let content = '';
      let editor = null;
      
      switch(type) {
        case 'activities':
          content = '<h3>Activities Performed:</h3><ul><li>Task 1: Description of what was accomplished</li><li>Task 2: Description of what was accomplished</li><li>Task 3: Description of what was accomplished</li></ul><h3>Technologies Used:</h3><ul><li>Technology 1</li><li>Technology 2</li></ul>';
          editor = activitiesEditor;
          break;
        case 'learning':
          content = '<h3>New Skills Acquired:</h3><ul><li>Skill 1: Description of what was learned</li><li>Skill 2: Description of what was learned</li></ul><h3>Knowledge Gained:</h3><ul><li>Concept 1: Explanation</li><li>Concept 2: Explanation</li></ul>';
          editor = learningEditor;
          break;
        case 'challenges':
          content = '<h3>Challenges Encountered:</h3><ul><li>Challenge 1: Description</li><li>Challenge 2: Description</li></ul><h3>Solutions Applied:</h3><ul><li>Solution 1: How it was resolved</li><li>Solution 2: How it was resolved</li></ul>';
          editor = challengesEditor;
          break;
        case 'plan':
          content = '<h3>Tomorrow\'s Goals:</h3><ul><li>Goal 1: Specific objective</li><li>Goal 2: Specific objective</li></ul><h3>Resources Needed:</h3><ul><li>Resource 1</li><li>Resource 2</li></ul>';
          editor = planEditor;
          break;
      }
      
      if (editor && content) {
        editor.clipboard.dangerouslyPasteHTML(content);
      }
    }
    
    function addCodeBlock() {
      const editor = getActiveEditor();
      if (editor) {
        editor.focus();
        const range = editor.getSelection();
        editor.insertText(range.index, '\n');
        editor.insertEmbed(range.index + 1, 'code-block', '// Your code here');
      }
    }
    
    function addImage() {
      const input = document.createElement('input');
      input.setAttribute('type', 'file');
      input.setAttribute('accept', 'image/*');
      input.click();
      
      input.onchange = () => {
        const file = input.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = (e) => {
            const editor = getActiveEditor();
            if (editor) {
              const range = editor.getSelection();
              editor.insertEmbed(range.index, 'image', e.target.result);
            }
          };
          reader.readAsDataURL(file);
        }
      };
    }
    
    function addBulletPoints() {
      const editor = getActiveEditor();
      if (editor) {
        editor.focus();
        const range = editor.getSelection();
        editor.insertText(range.index, '\nâ¢ Point 1\nâ¢ Point 2\nâ¢ Point 3');
      }
    }
    
    function addSolution() {
      const editor = getActiveEditor();
      if (editor) {
        editor.focus();
        const range = editor.getSelection();
        editor.insertText(range.index, '\n<h4>Solution Applied:</h4><p>Describe how you resolved this challenge...</p>');
      }
    }
    
    function addChecklist() {
      const editor = getActiveEditor();
      if (editor) {
        editor.focus();
        const range = editor.getSelection();
        editor.insertText(range.index, '\n<h4>Task Checklist:</h4><ul><li>â¡ Task 1</li><li>â¡ Task 2</li><li>â¡ Task 3</li></ul>');
      }
    }
    
    function getActiveEditor() {
      // Return the editor that currently has focus
      if (activitiesEditor.hasFocus()) return activitiesEditor;
      if (learningEditor.hasFocus()) return learningEditor;
      if (challengesEditor.hasFocus()) return challengesEditor;
      if (planEditor.hasFocus()) return planEditor;
      if (notesEditor.hasFocus()) return notesEditor;
      return activitiesEditor; // Default
    }
    
    // Form submission
    function submitEntry() {
      // Update hidden inputs with editor content
      document.getElementById('activitiesContent').value = activitiesEditor.root.innerHTML;
      document.getElementById('learningContent').value = learningEditor.root.innerHTML;
      document.getElementById('challengesContent').value = challengesEditor.root.innerHTML;
      document.getElementById('planContent').value = planEditor.root.innerHTML;
      document.getElementById('notesContent').value = notesEditor.root.innerHTML;
      
      // Validate form
      const form = document.getElementById('logbookForm');
      if (form.checkValidity()) {
        if (confirm('Are you sure you want to submit this logbook entry? You won\'t be able to edit it after submission.')) {
          alert('Logbook entry submitted successfully!');
          // In real implementation, this would send the form data to the server
          form.reset();
          clearEditors();
        }
      } else {
        alert('Please fill in all required fields before submitting.');
      }
    }
    
    function saveDraft() {
      // Save to localStorage
      const draftData = {
        date: document.getElementById('entry_date').value,
        week: document.getElementById('week_number').value,
        hours: document.getElementById('hours_worked').value,
        activities: activitiesEditor.root.innerHTML,
        learning: learningEditor.root.innerHTML,
        challenges: challengesEditor.root.innerHTML,
        plan: planEditor.root.innerHTML,
        notes: notesEditor.root.innerHTML,
        timestamp: new Date().toISOString()
      };
      
      localStorage.setItem('logbookDraft', JSON.stringify(draftData));
      alert('Draft saved successfully!');
    }
    
    function clearEditors() {
      activitiesEditor.setText('');
      learningEditor.setText('');
      challengesEditor.setText('');
      planEditor.setText('');
      notesEditor.setText('');
    }
    
    // Load draft on page load
    window.onload = function() {
      const draft = localStorage.getItem('logbookDraft');
      if (draft) {
        const data = JSON.parse(draft);
        if (data.date) document.getElementById('entry_date').value = data.date;
        if (data.week) document.getElementById('week_number').value = data.week;
        if (data.hours) document.getElementById('hours_worked').value = data.hours;
        if (data.activities) activitiesEditor.root.innerHTML = data.activities;
        if (data.learning) learningEditor.root.innerHTML = data.learning;
        if (data.challenges) challengesEditor.root.innerHTML = data.challenges;
        if (data.plan) planEditor.root.innerHTML = data.plan;
        if (data.notes) notesEditor.root.innerHTML = data.notes;
      }
    };
    
    // Other functions
    function viewAllEntries() {
      alert('Redirecting to all entries view...');
    }
    
    function viewEntry(week) {
      alert('Viewing Week ' + week + ' entry...');
    }
    
    function editEntry(week) {
      alert('Editing Week ' + week + ' entry...');
    }
    
    function exportEntry() {
      alert('Exporting entry...\nThis will be available for download shortly.');
    }
    
    function printEntry() {
      alert('Opening print preview...');
    }
    
    function shareEntry() {
      alert('Opening share options...');
    }
    
    function duplicateEntry() {
      alert('Duplicating entry...\nThis will create a new draft entry.');
    }
  </script>
</body>
</html> 